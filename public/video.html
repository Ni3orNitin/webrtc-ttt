<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Floating Video Call</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles to handle the floating UI */
        #videoCallContainer {
            position: fixed;
            bottom: 1rem;
            right: 1rem;
            z-index: 50; /* Ensures it's always on top */
            transition: transform 0.3s ease-in-out;
            transform-origin: bottom right;
        }

        /* Styles for the video elements */
        video {
            border-radius: 0.75rem; /* rounded-xl */
            background-color: #1f2937; /* bg-gray-800 */
        }
        
        /* State for the full, active video view */
        .floating-active {
            width: 20rem; /* w-80 */
            max-width: 90vw; /* Responsive scaling */
            display: block;
        }

        /* State for the minimized, inactive view (circle icon) */
        .floating-inactive {
            width: 5rem; /* w-20 */
            height: 5rem; /* h-20 */
            border-radius: 50%;
            overflow: hidden;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Hides elements based on view state */
        .full-view-content { display: none; }
        .minimized-view-content { display: none; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen p-8">

    <main class="max-w-4xl mx-auto space-y-8">
        <h1 class="text-4xl font-bold text-gray-800">Welcome to the Home Page</h1>
        <p class="text-gray-600 leading-relaxed">
            This is the main content of your website. The video call window will stay in the corner as you scroll or click different pages.
        </p>
        
        <div class="flex gap-4">
            <button onclick="changeContent('page1')" class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-6 rounded-full transition-colors duration-300">
                Show Page 1
            </button>
            <button onclick="changeContent('page2')" class="bg-green-500 hover:bg-green-600 text-white font-semibold py-2 px-6 rounded-full transition-colors duration-300">
                Show Page 2
            </button>
        </div>

        <div id="page1" class="hidden bg-white p-6 rounded-lg shadow-md">
            <h2 class="text-2xl font-semibold mb-2">Content for Page 1</h2>
            <p class="text-gray-700">This content can be replaced with any other content without reloading the page, so the video call remains uninterrupted.</p>
        </div>
        <div id="page2" class="hidden bg-white p-6 rounded-lg shadow-md">
            <h2 class="text-2xl font-semibold mb-2">Content for Page 2</h2>
            <p class="text-gray-700">You are on the second "page"! The video call is still floating in the corner, just like WhatsApp or Facebook Messenger.</p>
        </div>
    </main>

    <div id="videoCallContainer" class="bg-gray-800 rounded-xl shadow-2xl overflow-hidden cursor-pointer" onclick="toggleCallWindow()">
        
        <div id="fullCallView" class="full-view-content p-4">
            <h2 class="text-xl text-white font-semibold mb-2">Video Call</h2>
            <div class="grid grid-cols-2 gap-2 mb-4">
                <div class="flex flex-col items-center">
                    <video id="localVideo" class="w-full h-auto" autoplay muted playsinline></video>
                    <p class="text-gray-300 text-xs mt-1">Your Video</p>
                </div>
                <div class="flex flex-col items-center">
                    <video id="remoteVideo" class="w-full h-auto" autoplay playsinline></video>
                    <p class="text-gray-300 text-xs mt-1">Friend's Video</p>
                </div>
            </div>
            
            <div class="flex gap-2 justify-center">
                <button id="joinBtn" class="bg-blue-500 hover:bg-blue-600 text-white p-2 rounded-full text-sm">Join Call</button>
                <button id="muteMicBtn" class="bg-gray-600 hover:bg-gray-700 text-white p-2 rounded-full text-sm">Mute Mic</button>
                <button id="endCallBtn" class="bg-red-500 hover:bg-red-600 text-white p-2 rounded-full text-sm">End Call</button>
            </div>
        </div>

        <div id="minimizedView" class="minimized-view-content flex items-center justify-center p-4">
            <svg class="h-10 w-10 text-white" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"></path>
                <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"></path>
            </svg>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const videoCallContainer = document.getElementById('videoCallContainer');
            const fullCallView = document.getElementById('fullCallView');
            const minimizedView = document.getElementById('minimizedView');
            const localVideo = document.getElementById('localVideo');
            const remoteVideo = document.getElementById('remoteVideo');
            const joinBtn = document.getElementById('joinBtn');
            const muteMicBtn = document.getElementById('muteMicBtn');
            const endCallBtn = document.getElementById('endCallBtn');
            
            let localStream = null;
            let isMinimized = true;

            // Function to simulate page navigation
            window.changeContent = (pageId) => {
                document.querySelectorAll('main > div').forEach(page => {
                    page.classList.add('hidden');
                });
                const targetPage = document.getElementById(pageId);
                if (targetPage) {
                    targetPage.classList.remove('hidden');
                }
            };

            // Toggle the video window between active and minimized states
            window.toggleCallWindow = () => {
                isMinimized = !isMinimized;
                if (isMinimized) {
                    videoCallContainer.classList.remove('floating-active');
                    videoCallContainer.classList.add('floating-inactive');
                    fullCallView.classList.add('full-view-content');
                    minimizedView.classList.remove('minimized-view-content');
                } else {
                    videoCallContainer.classList.remove('floating-inactive');
                    videoCallContainer.classList.add('floating-active');
                    fullCallView.classList.remove('full-view-content');
                    minimizedView.classList.add('minimized-view-content');
                }
            };

            // WebRTC Logic
            const joinCall = async () => {
                try {
                    // Request camera and microphone access
                    localStream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
                    localVideo.srcObject = localStream;
                    // Simulate a remote stream by mirroring the local stream
                    remoteVideo.srcObject = localStream;
                    console.log('Joined the call. Streams are active.');
                } catch (error) {
                    console.error('Error accessing media devices.', error);
                    alert('Could not access camera/mic. Please ensure permissions are granted.');
                }
            };

            const endCall = () => {
                if (localStream) {
                    // Stop all tracks to release camera/mic
                    localStream.getTracks().forEach(track => track.stop());
                }
                localVideo.srcObject = null;
                remoteVideo.srcObject = null;
                console.log('Call ended. Streams stopped.');
            };

            const toggleMuteMic = () => {
                if (localStream) {
                    const audioTrack = localStream.getAudioTracks()[0];
                    if (audioTrack) {
                        audioTrack.enabled = !audioTrack.enabled;
                        muteMicBtn.textContent = audioTrack.enabled ? 'Mute Mic' : 'Unmute Mic';
                        console.log(`Microphone is now ${audioTrack.enabled ? 'enabled' : 'muted'}.`);
                    }
                }
            };
            
            // Attach event listeners to buttons
            joinBtn.addEventListener('click', (event) => {
                event.stopPropagation(); // Prevents toggleCallWindow from firing
                joinCall();
            });
            muteMicBtn.addEventListener('click', (event) => {
                event.stopPropagation();
                toggleMuteMic();
            });
            endCallBtn.addEventListener('click', (event) => {
                event.stopPropagation();
                endCall();
            });

            // Initially set the view to minimized
            toggleCallWindow();
        });
    </script>

</body>
</html>